{
    "sourceFile": "frontend/src/pages/Wards/WardDetails.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1749586385234,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1749586385234,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate, Link } from 'react-router-dom';\r\nimport { wardsApi } from '../../services/api';\r\nimport LoadingSpinner from '../../components/common/LoadingSpinner';\r\n\r\nconst WardDetails = () => {\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  \r\n  const [ward, setWard] = useState(null);\r\n  const [currentPatients, setCurrentPatients] = useState([]);\r\n  const [recentHistory, setRecentHistory] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    fetchWardDetails();\r\n  }, [id]);\r\n\r\n  const fetchWardDetails = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await wardsApi.getById(id);\r\n      \r\n      if (response.success) {\r\n        setWard(response.data.ward);\r\n        setCurrentPatients(response.data.currentPatients || []);\r\n        setRecentHistory(response.data.recentHistory || []);\r\n      } else {\r\n        throw new Error(response.error || 'Failed to fetch ward details');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching ward details:', err);\r\n      setError('Failed to load ward details. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getOccupancyClass = (current, capacity) => {\r\n    const rate = (current / capacity) * 100;\r\n    if (rate < 50) return 'text-green-600';\r\n    if (rate < 80) return 'text-yellow-600';\r\n    return 'text-red-600';\r\n  };\r\n\r\n  const getOccupancyBarClass = (current, capacity) => {\r\n    const rate = (current / capacity) * 100;\r\n    if (rate < 50) return 'bg-green-500';\r\n    if (rate < 80) return 'bg-yellow-500';\r\n    return 'bg-red-500';\r\n  };\r\n\r\n  if (loading) {\r\n    return <LoadingSpinner />;\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-red-50 border-l-4 border-red-400 p-4\">\r\n        <p className=\"text-sm text-red-700\">{error}</p>\r\n        <button\r\n          onClick={() => navigate('/wards')}\r\n          className=\"mt-2 text-sm text-red-700 underline\"\r\n        >\r\n          Back to wards list\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!ward) {\r\n    return (\r\n      <div className=\"text-center py-10\">\r\n        <p className=\"text-lg text-gray-600\">Ward not found</p>\r\n        <Link to=\"/wards\" className=\"mt-4 text-blue-600 hover:underline\">\r\n          Back to wards list\r\n        </Link>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-2xl font-semibold text-gray-900\">\r\n          {ward.ward_name} - {ward.ward_type}\r\n        </h1>\r\n        <Link\r\n          to=\"/wards\"\r\n          className=\"px-4 py-2 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50\"\r\n        >\r\n          Back to Wards\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Ward Overview Card */}\r\n      <div className=\"bg-white p-6 shadow rounded-lg mb-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Ward Info</h3>\r\n            <p className=\"text-gray-600\">Type: {ward.ward_type}</p>\r\n            <p className=\"text-gray-600\">ID: {ward.ward_id}</p>\r\n          </div>\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Capacity</h3>\r\n            <p className=\"text-3xl font-bold\">{ward.capacity} beds</p>\r\n          </div>\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Current Occupancy</h3>\r\n            <p className={`text-3xl font-bold ${getOccupancyClass(ward.current_occupancy, ward.capacity)}`}>\r\n              {ward.current_occupancy}/{ward.capacity} beds\r\n            </p>\r\n            <div className=\"w-full bg-gray-200 rounded-full h-4 mt-2\">\r\n              <div \r\n                className={`h-4 rounded-full ${getOccupancyBarClass(ward.current_occupancy, ward.capacity)}`} \r\n                style={{width: `${(ward.current_occupancy / ward.capacity) * 100}%`}}\r\n              ></div>\r\n            </div>\r\n            <p className=\"mt-2 text-sm text-gray-600\">\r\n              {ward.available_beds} beds available\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Current Patients */}\r\n      <div className=\"bg-white shadow rounded-lg mb-6\">\r\n        <div className=\"px-6 py-4 border-b border-gray-200\">\r\n          <h2 className=\"text-xl font-medium text-gray-900\">Current Patients</h2>\r\n        </div>\r\n        <div className=\"overflow-x-auto\">\r\n          {currentPatients.length > 0 ? (\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Patient\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Contact\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Gender\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Admission Date\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Days Admitted\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Actions\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {currentPatients.map((patient) => (\r\n                  <tr key={patient.admission_id}>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">\r\n                        {patient.patient_first_name} {patient.patient_last_name}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">{patient.patient_phone}</div>\r\n                      <div className=\"text-sm text-gray-500\">{patient.patient_email}</div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">{patient.patient_gender}</div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {new Date(patient.admission_date).toLocaleDateString()}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">{patient.days_admitted} days</div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                      <Link\r\n                        to={`/patients/${patient.patient_id}`}\r\n                        className=\"text-blue-600 hover:text-blue-900\"\r\n                      >\r\n                        View Patient\r\n                      </Link>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          ) : (\r\n            <div className=\"px-6 py-4 text-center text-gray-500\">\r\n              No patients currently admitted to this ward\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Recent Admissions History */}\r\n      <div className=\"bg-white shadow rounded-lg\">\r\n        <div className=\"px-6 py-4 border-b border-gray-200\">\r\n          <h2 className=\"text-xl font-medium text-gray-900\">Recent Admissions History</h2>\r\n        </div>\r\n        <div className=\"overflow-x-auto\">\r\n          {recentHistory.length > 0 ? (\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Patient\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Admission Date\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Discharge Date\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Length of Stay\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {recentHistory.map((admission) => (\r\n                  <tr key={admission.admission_id}>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">\r\n                        {admission.patient_first_name} {admission.patient_last_name}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {new Date(admission.admission_date).toLocaleDateString()}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {admission.discharge_date \r\n                          ? new Date(admission.discharge_date).toLocaleDateString() \r\n                          : 'Still admitted'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">\r\n                        {admission.length_of_stay ? `${admission.length_of_stay} days` : 'N/A'}\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          ) : (\r\n            <div className=\"px-6 py-4 text-center text-gray-500\">\r\n              No admission history found\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WardDetails;\r\n"
        }
    ]
}